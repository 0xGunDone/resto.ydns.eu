# Архитектура системы прав доступа

## Общая концепция

1. **Глобальные роли** (OWNER, ADMIN, MANAGER, EMPLOYEE) - определяют уровень доступа к системе
2. **Должности** (Position) - определяют права доступа внутри ресторана
3. **Права доступа** (Permission) - конкретные действия, которые можно выполнять

## Иерархия прав

- **OWNER/ADMIN**: Видят все рестораны, имеют все права
- **MANAGER**: Видят только свой ресторан, права определяются должностью
- **EMPLOYEE**: Видят только рестораны, где работают, права определяются должностью в каждом ресторане

## Мульти-ресторанность

Если сотрудник работает в нескольких ресторанах:
- Он видит все рестораны, где работает
- Права для каждого ресторана определяются его должностью в этом ресторане
- Права не объединяются между ресторанами (права в ресторане А не дают прав в ресторане Б)

Подробнее см.:
- [Регистрация в нескольких ресторанах](multi-restaurant-registration.md)
- [Права в нескольких ресторанах](multi-restaurant-permissions.md)

## Список прав (Permission)

### Рестораны
- `VIEW_RESTAURANTS` - просмотр списка ресторанов
- `EDIT_RESTAURANTS` - редактирование ресторанов

### График работы
- `VIEW_SCHEDULE` - просмотр графика
- `EDIT_SCHEDULE` - редактирование графика (назначение смен)

### Обмен сменами
- `REQUEST_SHIFT_SWAP` - запрос на обмен сменами (по умолчанию у всех сотрудников)
- `APPROVE_SHIFT_SWAP` - одобрение обмена сменами (менеджеры)

### Типы смен
- `VIEW_SHIFT_TYPES` - просмотр типов смен
- `EDIT_SHIFT_TYPES` - редактирование типов смен

### Задачи
- `VIEW_OWN_TASKS` - просмотр только своих задач (где исполнитель или создатель)
- `VIEW_ALL_TASKS` - просмотр всех задач ресторана
- `EDIT_TASKS` - создание/редактирование задач

### Табели
- `VIEW_OWN_TIMESHEETS` - просмотр только своих табелей и зарплаты
- `VIEW_ALL_TIMESHEETS` - просмотр всех табелей ресторана
- `EDIT_TIMESHEETS` - редактирование табелей

### Сотрудники
- `VIEW_EMPLOYEES` - просмотр сотрудников
- `EDIT_EMPLOYEES` - добавление/редактирование сотрудников

### Должности
- `VIEW_POSITIONS` - просмотр должностей
- `EDIT_POSITIONS` - редактирование должностей

### Отделы
- `VIEW_DEPARTMENTS` - просмотр отделов
- `EDIT_DEPARTMENTS` - редактирование отделов

### Объявления
- `VIEW_ANNOUNCEMENTS` - просмотр объявлений (по умолчанию у всех)
- `SEND_ANNOUNCEMENTS` - отправка объявлений (менеджеры)

### Отчеты
- `VIEW_REPORTS` - просмотр отчетов (менеджеры)
- `EXPORT_REPORTS` - экспорт отчетов (менеджеры)

## Структура БД

```
Permission (id, code, name, description)
PositionPermission (positionId, permissionId)
```

## Проверка прав

При проверке прав учитывается:
1. Глобальная роль (OWNER/ADMIN = все права)
2. Должность пользователя в конкретном ресторане
3. Права, назначенные этой должности

### Примеры использования

См. [Использование прав в коде](permissions-usage.md) для примеров и API endpoints.

### Реализация

Все этапы реализации завершены. См. [План реализации](permissions-implementation-plan.md) для подробностей.

