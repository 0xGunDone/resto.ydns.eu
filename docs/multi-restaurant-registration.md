# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞
–û–¥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö, –∏ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —É–¥–æ–±–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.

### –†–µ—à–µ–Ω–∏–µ

–í —Å–∏—Å—Ç–µ–º–µ —É–∂–µ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—ã—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö:
- –¢–∞–±–ª–∏—Ü–∞ `RestaurantUser` —Å–≤—è–∑—ã–≤–∞–µ—Ç User —Å Restaurant
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á: `@@unique([restaurantId, userId])`
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: –æ–¥–∏–Ω User –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π RestaurantUser (–¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤)

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω**
1. –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ "–ú–æ—Å–∫–≤–∞"
2. –°—Å—ã–ª–∫–∞: `https://t.me/resto_bot?start=abc123`
3. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –ò–≤–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
4. –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç: –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω
5. –°–æ–∑–¥–∞–µ—Ç—Å—è:
   - User (telegramId = 123456789)
   - RestaurantUser (userId = –ò–≤–∞–Ω–∞, restaurantId = "–ú–æ—Å–∫–≤–∞")

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—Ç–æ—Ä–æ–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω**
1. –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ "–°–ü–±"
2. –°—Å—ã–ª–∫–∞: `https://t.me/resto_bot?start=xyz789`
3. –¢–æ—Ç –∂–µ –ò–≤–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
4. –ë–æ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ telegramId, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ
5. –ë–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: "–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω '–°–ü–±'?"
6. –ò–≤–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç
7. –°–æ–∑–¥–∞–µ—Ç—Å—è:
   - RestaurantUser (userId = –ò–≤–∞–Ω–∞, restaurantId = "–°–ü–±") - –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å!

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- 1 User (–ò–≤–∞–Ω)
- 2 RestaurantUser (–ú–æ—Å–∫–≤–∞, –°–ü–±)
- –ò–≤–∞–Ω –≤–∏–¥–∏—Ç –æ–±–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä–∞

1. –ò–≤–∞–Ω —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ "–ú–æ—Å–∫–≤–∞"
2. –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ "–°–ü–±" –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ:
   - –ò—â–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ telegramId –∏–ª–∏ –∏–º–µ–Ω–∏
   - –ù–∞–∂–∏–º–∞–µ—Ç "–î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω"
   - –í—ã–±–∏—Ä–∞–µ—Ç –¥–æ–ª–∂–Ω–æ—Å—Ç—å –∏ –æ—Ç–¥–µ–ª
   - –°–æ–∑–¥–∞–µ—Ç—Å—è RestaurantUser –¥–ª—è "–°–ü–±"

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å:** –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞  
‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ:** –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –º–æ–∂–µ—Ç —Å–∞–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞  
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å:** –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤—Ä—É—á–Ω—É—é  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```typescript
// –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
async function registerViaBot(telegramId: string, token: string) {
  // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
  const inviteLink = await getInviteLink(token);
  
  // 2. –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  let user = await getUserByTelegramId(telegramId);
  
  if (!user) {
    // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Å–æ–∑–¥–∞–µ–º
    user = await createUser({
      telegramId,
      firstName: "...",
      lastName: "...",
      phone: "...",
    });
  }
  
  // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —É–∂–µ –≤ —ç—Ç–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ
  const existing = await getRestaurantUser(user.id, inviteLink.restaurantId);
  
  if (existing) {
    return "–í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —ç—Ç–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ";
  }
  
  // 4. –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω
  await createRestaurantUser({
    userId: user.id,
    restaurantId: inviteLink.restaurantId,
    positionId: inviteLink.positionId,
    departmentId: inviteLink.departmentId,
  });
  
  return "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!";
}
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä 1: –ò–≤–∞–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–≤—É—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö**
```
User: { id: "user1", telegramId: "123456789", firstName: "–ò–≤–∞–Ω", ... }
RestaurantUser 1: { userId: "user1", restaurantId: "moscow", positionId: "waiter" }
RestaurantUser 2: { userId: "user1", restaurantId: "spb", positionId: "senior_waiter" }
```

**–ü—Ä–∏–º–µ—Ä 2: –ò–≤–∞–Ω –∏–º–µ–µ—Ç —Ä–∞–∑–Ω—ã–µ –ø—Ä–∞–≤–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö**
- –í —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ "–ú–æ—Å–∫–≤–∞": –¥–æ–ª–∂–Ω–æ—Å—Ç—å "–û—Ñ–∏—Ü–∏–∞–Ω—Ç" ‚Üí –ø—Ä–∞–≤–∞ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞
- –í —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ "–°–ü–±": –¥–æ–ª–∂–Ω–æ—Å—Ç—å "–°—Ç–∞—Ä—à–∏–π –æ—Ñ–∏—Ü–∏–∞–Ω—Ç" ‚Üí –ø—Ä–∞–≤–∞ —Å—Ç–∞—Ä—à–µ–≥–æ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞
- –ü—Ä–∞–≤–∞ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å—é –≤ –∫–∞–∂–¥–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –æ—Ç–¥–µ–ª—å–Ω–æ

## –†–µ–∑—é–º–µ

‚úÖ **–û–¥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ = –æ–¥–∏–Ω User**  
‚úÖ **–û–¥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ = –Ω–µ—Å–∫–æ–ª—å–∫–æ RestaurantUser (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω)**  
‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**  
‚úÖ **–ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤—Ä—É—á–Ω—É—é**  

–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –º—É–ª—å—Ç–∏-—Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º! üéØ

