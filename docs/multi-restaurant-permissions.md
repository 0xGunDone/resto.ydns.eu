# Решение для работы в нескольких ресторанах

## Проблема
Один сотрудник может работать в двух ресторанах, и нужно определить, какие права у него есть в каждом ресторане.

## Решение

### Принцип работы:

1. **Права определяются должностью в конкретном ресторане**
   - В ресторане А: должность "Официант" → права официанта
   - В ресторане Б: должность "Старший официант" → права старшего официанта

2. **Права не объединяются между ресторанами**
   - Права в ресторане А не дают прав в ресторане Б
   - Каждый ресторан - независимая система прав

3. **При запросе всегда указывается restaurantId**
   - API проверяет права для конкретного ресторана
   - Пользователь видит только те рестораны, где работает

### Пример:

Сотрудник Иван работает:
- В ресторане "Москва": должность "Официант" (может только просматривать свой график)
- В ресторане "СПб": должность "Старший официант" (может просматривать график всех и редактировать)

**При доступе к API:**
- GET /schedule?restaurantId=moscow → проверяются права официанта → только просмотр своего
- GET /schedule?restaurantId=spb → проверяются права старшего официанта → просмотр всех + редактирование

### Реализация:

```typescript
// Проверка прав
async function checkPermission(
  userId: string,
  restaurantId: string,
  permission: string
): Promise<boolean> {
  // 1. OWNER/ADMIN всегда имеют все права
  const user = await getUser(userId);
  if (user.role === 'OWNER' || user.role === 'ADMIN') {
    return true;
  }
  
  // 2. Получаем должность пользователя в этом ресторане
  const restaurantUser = await getRestaurantUser(userId, restaurantId);
  if (!restaurantUser) {
    return false; // Не работает в этом ресторане
  }
  
  // 3. Проверяем права должности
  const hasPermission = await checkPositionPermission(
    restaurantUser.positionId,
    permission
  );
  
  return hasPermission;
}
```

### Вопросы для обсуждения:

1. **Должен ли менеджер ресторана иметь все права в своем ресторане автоматически?**
   - Вариант А: Да, менеджер всегда имеет все права в своем ресторане
   - Вариант Б: Нет, права менеджера тоже определяются должностью

2. **Нужна ли возможность временно дать дополнительные права?**
   - Например, на время отпуска менеджера

3. **Как обрабатывать случай, когда у пользователя нет должности в ресторане?**
   - Вариант А: Запрещать доступ полностью
   - Вариант Б: Давать минимальные права (только просмотр своего)

